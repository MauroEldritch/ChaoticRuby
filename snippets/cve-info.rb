#!/usr/bin/ruby
#Snippet: cve-info.rb
require 'net/http'
require 'json'

#Main function: Fetch CVE details and check for exploits
def fetch_cve_details(cve_id)
    begin
        response = Net::HTTP.get_response(URI("https://services.nvd.nist.gov/rest/json/cves/2.0?cveId=#{cve_id}"))
        cve_data = JSON.parse(response.body)
        process_cve_data(cve_id, cve_data)
    rescue
        puts "[!] Error fetching data."
    end
end

#Process and display CVE details
def process_cve_data(cve_id, cve_data)
    vuln = cve_data['vulnerabilities'].first['cve']
    description = vuln['descriptions']&.find { |d| d['lang'] == 'en' }&.dig('value') || "No description available."
    cvss = vuln.dig('metrics', 'cvssMetricV30', 0, 'cvssData', 'baseScore') || "N/A"
    severity = vuln.dig('metrics', 'cvssMetricV30', 0, 'cvssData', 'baseSeverity') || "Unknown"
    puts "\tDescription: #{description}\n\tCVSS Score: #{cvss} (#{severity})"
    references = vuln['references'] || []
    exploit_refs = references.select { |ref| ref['tags']&.include?('Exploit') }
    if exploit_refs.any?
        puts "[*] Exploits found:"
        exploit_refs.each { |ref| puts "  - #{ref['url']}" }
    end
end

#Defaults and user input
cve_id = ARGV[0] || "CVE-2018-19466" #Default CVE ID
puts "[*] CVE Details for #{cve_id}:"
fetch_cve_details(cve_id)
